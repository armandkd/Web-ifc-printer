/**
 * @author alteredq / http://alteredqualia.com/
 * @author bhouston / http://exocortex.com
 */

// create the performance timer THREE.now for THREE.Clock as accurate as we can.



THREE.Clock = function ( autoStart ) {

	this.autoStart = ( autoStart !== undefined ) ? autoStart : true;

	this.startTime = 0;
	this.oldTime = 0;
	this.elapsedTime = 0;

	this.running = false;

};

THREE.Clock.now = (function() {

	var this_window = self['window'];
	// is this a standard browser window with standard profiling tools?
	if( this_window !== undefined && this_window.performance !== undefined && this_window.performance.now !== undefined ) {

		return this_window.performance.now;

	}

	// are we in a nodejs environment with a high precision timer?
	var this_process = self['process'];
	if( ( this_process !== undefined ) && ( this_process.hrtime !== undefined ) ) {

		return function () {

			var time = this_process.hrtime();
			return ( time[0] + time[1] / 1e9 ) * 1000;

		};

	}

	// just use the default Date class.
	return function() {

		return new Date().getTime();

	};

})();

THREE.Clock.prototype = {

	constructor: THREE.Clock,

	start: function () {

		this.startTime = THREE.Clock.now();

		this.oldTime = this.startTime;
		this.running = true;
	},

	stop: function () {

		this.getElapsedTime();
		this.running = false;

	},

	getElapsedTime: function () {

		this.getDelta();
		return this.elapsedTime;

	},

	getDelta: function () {

		var diff = 0;

		if ( this.autoStart && ! this.running ) {

			this.start();

		}

		if ( this.running ) {

			var newTime = THREE.Clock.now();

			diff = 0.001 * ( newTime - this.oldTime );
			this.oldTime = newTime;

			this.elapsedTime += diff;

		}

		return diff;

	}

};
